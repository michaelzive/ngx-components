<mat-drawer-container class="drawer-panel-container"
  [class.horizontal]="isHorizontal()"
  [class.vertical]="isVertical()"
  [class.expanded]="isExpanded()"
  [class.variant-ag]="isAgVariant()"
  [hasBackdrop]="isExpanded() && hasBackdrop()">

  <mat-drawer-content class="drawer-main-content">
    <ng-content></ng-content>
  </mat-drawer-content>

  <mat-drawer #sidenav
    class="drawer-panel"
    [class.variant-ag]="isAgVariant()"
    [class.collapsed]="!isExpanded()"
    [mode]="mode()"
    [position]="drawerPosition()"
    [style.width.px]="isVertical() ? (isExpanded() ? panelSize() : collapsedThickness()) : null"
    [style.height.px]="isHorizontal() ? (isExpanded() ? panelSize() : collapsedThickness()) : null"
    [attr.aria-label]="'Drawer panel docked ' + dock()">

  <div class="drawer-content" [class.collapsed]="!isExpanded()" @expandCollapse>
      @if (isExpanded() && allTabs().length) {
        <mat-tab-group
          class="drawer-tabs"
          [selectedIndex]="activeIndex()"
          (selectedIndexChange)="onTabGroupIndexChange($event)"
          [attr.aria-label]="'Drawer panel tabs'">
          @for (tab of allTabs(); track tab.id || tab.label; let i = $index) {
            <mat-tab [label]="tab.label" [disabled]="tab.disabled">
              @if (tab.content) {
                <ng-container [ngTemplateOutlet]="tab.content" [ngTemplateOutletContext]="{ $implicit: tab.data, tab: tab, index: i }"></ng-container>
              } @else {
                <div class="tab-fallback">No content for {{ tab.label }}</div>
              }
            </mat-tab>
          }
        </mat-tab-group>
      }
  @if (resizable() && isExpanded()) {
        <div #resizeHandle
          class="resize-handle"
          [class.vertical-handle]="isVertical()"
          [class.horizontal-handle]="isHorizontal()"
          [class.handle-left]="dock()==='left'"
          [class.handle-right]="dock()==='right'"
          [class.handle-top]="dock()==='top'"
          [class.handle-bottom]="dock()==='bottom'"
          tabindex="0"
          role="separator"
          (keydown)="onKeyResize($event)"
          (mousedown)="onResizeStart($event)"
          (touchstart)="onResizeStart($event)">
          <div class="resize-line"></div>
        </div>
      }
    </div>
  </mat-drawer>

  <!-- Collapsed / Expanded tab strip (always visible for toggling) -->
  <div class="drawer-tab-strip"
    [class.vertical-strip]="isVertical()"
    [class.horizontal-strip]="isHorizontal()"
    [class.strip-left]="dock()==='left'"
    [class.strip-right]="dock()==='right'"
    [class.strip-top]="dock()==='top'"
    [class.strip-bottom]="dock()==='bottom'"
    [class.expanded]="isExpanded()"
    [class.variant-ag]="isAgVariant()"
    [attr.role]="'tablist'"
  [attr.aria-orientation]="isVertical() ? 'vertical' : 'horizontal'"
  (keydown)="onTabStripKeydown($event)">
    @for (tab of allTabs(); track tab.id || tab.label; let i = $index) {
      <button type="button"
        class="tab-label"
        [class.variant-ag]="isAgVariant()"
        [id]="'drawer-tab-'+i"
        [attr.aria-controls]="'drawer-tabpanel-'+i"
        [class.active]="i === activeIndex()"
        [disabled]="tab.disabled"
        (click)="onTabLabelClick(i)"
        [attr.role]="'tab'"
        [attr.aria-selected]="i === activeIndex()"
        [attr.aria-label]="tab.ariaLabel || tab.label"
        [attr.tabindex]="0">
        @if (tab.icon) { <mat-icon class="tab-icon">{{ tab.icon }}</mat-icon> }
        <span class="tab-text">{{ tab.label }}</span>
  @if (i === activeIndex()) {
          <span class="active-indicator" @tabIndicator></span>
        }
      </button>
    }
  </div>
</mat-drawer-container>
